(function(e,t){"use strict";t.Bookmark=e.Model.extend({defaults:{publik:!1,date:(new Date).getTime(),url:"",title:"",notes:"",starred:!1,tags:["uncategorised"]},createUrlRoot:function(e){return this.urlRoot=e,this}})})(Backbone,App.Models),function(e,t){"use strict";t.Bookmarks=Backbone.Pagination.extend({model:e.Bookmark,url:"/bookmarks",perPage:10,groupLimit:10,currentPage:1})}(App.Models,App.Collections),function(e,t,n,r,i){"use strict";t.Profile=e.View.extend({el:i("#profile"),settingsTemplate:new r({url:"/javascripts/views/forms/tmpl/profile.ejs"}),events:{"submit #settings-form":"updateUser","submit #delete":"promptUser"},initialize:function(){_.bindAll(this,"render","getUserData","updateUser","updateForm","promptUser");if(App.page==="demo")return;return this.model=new n.User,this.model.task="update",this.model.on("change",this.updateForm),n.User=this.model,this},render:function(){if(App.page==="demo")return;return this.getUserData(function(e){var t=this.settingsTemplate.render(e);this.$el.append(t)}.bind(this)),this},updateForm:function(){i("#email").attr("value",this.model.get("email")),i("#name").attr("value",this.model.get("name"))},promptUser:function(e){return confirm("Are you sure you want to delete your account?")},updateUser:function(e){e.preventDefault();var t=this.formToObject("settings-form"),n,r;n=function(e,t){i("#email").hasClass("warning")&&i("#email").removeClass("warning"),i("#name").hasClass("warning")&&i("#name").removeClass("warning"),i.shout(t.msg,10,"success")},r=function(e,t){i.shout(t.msg||t,10,"error")},this.model.save(t,{success:n,error:r,wait:!0})},getUserData:function(e){this.model.fetch({success:function(t,n){e(n)},error:function(t,n){e({name:"",email:"",password:""})}})},formToObject:function(e){var t,n={},r=i("#"+e).serializeArray();for(t=0;t<r.length;t++)r[t].name!=="submit"&&(n[r[t].name]=r[t].value);return n}})}(Backbone,App.Views,App.Models,EJS,jQuery),function(e,t,n,r,i){"use strict";t.Bookmark=e.View.extend({tagName:"tr",className:"bookmark",events:{dblclick:"loadEditor","click .bookmark-main-edit .bookmark-edit-link":"loadEditor","click .bookmark-main-edit .bookmark-delete":"deleteBookmark","click .cancel":"cancelEdit","submit .bookmark-edit-form":"saveEdit","click #new-bookmark-form .cancel":"cancelNew","submit #new-bookmark-form":"saveNew"},activeEditor:!1,activeNew:!1,editTemplate:new r({url:"/javascripts/views/bookmark/tmpl/edit.ejs"}),bookmarkTemplate:new r({url:"/javascripts/views/bookmark/tmpl/bookmark.ejs"}),newBookmarkTemplate:new r({url:"/javascripts/views/bookmark/tmpl/new.ejs"}),initialize:function(){var e=this;return _.bindAll(this,"render","unrender","saveEdit","cancelNew","newBookmark","saveNew","cancelEdit","update","loadEditor","deleteBookmark","getCleanModel"),this.model.on("change",function(){var e=["publik","url","title","notes","starred","tags"],t;for(t=0;t<e.length;t++)this.model.hasChanged(e[t])&&this.update(e[t])}.bind(this)),this},render:function(){var e=this.getCleanModel(),t;return t=this.bookmarkTemplate.render(e),this.$el.append(t),this},unrender:function(){this.$el.addClass("highlight").fadeOut(function(){this.$el.remove()}.bind(this))},newBookmark:function(){var e=this.formatDate(),t=this.newBookmarkTemplate.render(e);return this.activeNew=!0,this.$el.append(t),this},saveEdit:function(e){e.preventDefault();var n=[],r={},s,o,u=this.$(".bookmark-edit-form"),a=this.$(".bookmark-edit"),f=u.serializeArray(),l=App.page==="demo"?"Error, unauthorised user":"Error occured, bookmark not updated";_.each(f,function(e){e.name!=="submit"&&(r[e.name]=e.value)}),r.tags=r.tags.split(",")||[r.tags],r.publik=!r.publik,_.each(r.tags,function(e){n.push(e.trim())}),r.tags=n,s=function(e,n){this.activeEditor=!1,i.shout(n.msg,10,"success"),t.Controls.render()}.bind(this),o=function(e,t){this.activeEditor=!1,i.shout(l,10)}.bind(this),a.fadeOut(function(){a.empty().hide(),this.$(".bookmark-main").fadeIn()}.bind(this)),this.model.save(r,{success:s,error:o,wait:!0})},saveNew:function(e){e.preventDefault();var t={},r,s,o=this.$("#new-bookmark-form"),u=o.serializeArray(),a=this,f=[],l=App.page==="demo"?"Error, unauthorised user":"Error occured, bookmark not saved";_.each(u,function(e){e.name!=="submit"&&(t[e.name]=e.value)}),t.tags=t.tags.replace(" ",""),t.tags=t.tags.split(",")||["uncategorised"],t.publik=!t.publik,_.each(t.tags,function(e){f.push(e.trim())}),t.tags=f,r=function(e,t){a.activeNew=!1,a.model.set({id:t.model.id}),n.Bookmarks.origModels.push(a.model),i.shout("New bookmark saved!",10,"success"),a.$el.fadeOut("slow",function(){a.$el.remove(),location.hash="#bookmarks"})},s=function(e,t){a.activeNew=!1,i.shout(l,10),a.$el.fadeOut("slow",function(){a.$el.remove(),location.hash="#bookmarks"})},this.model.save(t,{success:r,error:s,wait:!0})},cancelNew:function(e){e.preventDefault();var t=this;t.$el.fadeOut("slow",function(){t.$el.remove(),location.hash="#bookmarks"})},deleteBookmark:function(e){e.preventDefault();var t,r,s=App.page==="demo"?"Error, unauthorised user":"Error occured, bookmark not deleted";if(!confirm("Are you sure you want to delete this bookmark?"))return!1;r=function(e,t){this.unrender(),i.shout(t.msg,10,"success"),n.Bookmarks.refresh()}.bind(this),t=function(e,t){i.shout(s,10)}.bind(this),this.model.destroy({success:r,error:t,wait:!0})},cancelEdit:function(e){e.preventDefault(),this.$(".bookmark-edit").fadeOut(function(){this.$(".bookmark-edit").empty(),this.$(".bookmark-main").fadeIn(),this.activeEditor=!1}.bind(this))},loadEditor:function(e){e.preventDefault();if(this.activeEditor||this.activeNew)return!1;var t=this.model.toJSON(),n;t.tags=t.tags.length>1?t.tags.join(","):t.tags[0],n=this.editTemplate.render(t),this.$(".bookmark-main").fadeOut(function(){this.$(".bookmark-edit").html(n).fadeIn(),this.activeEditor=!0}.bind(this))},update:function(e){var t,n,r,s;switch(e){case"title":this.$(".bookmark-url").html(this.model.escape("title"));break;case"notes":this.$(".bookmark-notes").html(this.model.escape("notes"));break;case"url":this.$(".bookmark-url").attr({href:this.model.escape("url")});break;case"tags":t=this.$(".bookmark-tags"),t.find(".b-tag").remove(),r=this.model.get("tags"),_.each(r,function(e){s=i("<span>",{"class":"label",html:e.toLowerCase()}),t.append(s)});break;case"publik":t=this.$(".bookmark-tags"),t.find("#label").remove(),n=i("<span>",{id:"label",html:this.model.get("publik")?"Public":"Private","class":this.model.get("publik")?"label label-important":"label label-info"}),t.append(n)}},formatDate:function(e){var t,n={},r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return e?t=new Date(parseInt(e,10)):t=new Date,n.day=t.getDate(),n.month=r[t.getMonth()],n.year=t.getFullYear(),n},getCleanModel:function(){var e={},t=this.model,n=this.formatDate(t.get("date")),r=document.createElement("a");return e.url=decodeURIComponent(t.get("url")),r.href=e.url,e.notes=t.escape("notes"),e.title=t.escape("title"),e.tags=t.get("tags"),e.publik=t.get("publik"),e.starred=t.get("starred"),e.id=t.get("id"),e.hostname=r.hostname,e.day=n.day,e.month=n.month,e.year=n.year,e}})}(Backbone,App.Views,App.Collections,EJS,jQuery),function(e,t,n){"use strict";t.Bookmarks=e.View.extend({el:n("#bookmarks-table"),initialize:function(){return _.bindAll(this,"addBookmark","viewAllBookmarks","bookmarksHeader","render"),n(".dropdown-toggle").dropdown(),this.collection.on("add",this.addBookmark),this.collection.on("reset",this.viewAllBookmarks),this},render:function(){return this},addBookmark:function(e){var n=new t.Bookmark({model:e});this.$el.append(n.render().el)},newBookmark:function(e){var n=new t.Bookmark({model:e});this.$el.html(n.newBookmark().el)},bookmarksHeader:function(){var e=n("<thead>"),t=n("<tr>"),r=this.collection.info(),i="",s;this.collection.filteredTag&&(i+='<i class="icon-tags"></i> <span class="label label-important">'+this.collection.filteredTag.toUpperCase()+"</span> &nbsp; "),i+="Page "+r.currentPage+" of "+r.totalPages,this.collection.filteredTag&&(i+='<a href="#bookmarks" class="close">&times;</a>'),s=n("<th>",{colspan:2,html:i}),t.append(s),e.append(t),this.$el.append(e)},viewAllBookmarks:function(){this.$el.fadeOut(function(){this.$el.empty(),this.bookmarksHeader(),this.collection.forEach(this.addBookmark),this.$el.fadeIn()}.bind(this))}})}(Backbone,App.Views,jQuery),function(e,t,n,r,i){"use strict";n.Controls=e.View.extend({el:i("#controls"),controlsTemplate:new r({url:"/javascripts/views/controls/tmpl/controls.ejs"}),newBookmarkTemplate:new r({url:"/javascripts/views/controls/tmpl/new.ejs"}),events:{"click #new-bookmark-form .cancel":"clearNewBookmark","click .btn-group .limit a":"changeCount","click .btn-group .sort a":"sort"},initialize:function(){_.bindAll(this,"render","clearNewBookmark")},render:function(){var e,t=this.collection.getTags();return e=this.controlsTemplate.render({tags:t,filteredTag:this.collection.filteredTag}),this.$el.html(e),this},filterTags:function(e){var n=this;e&&(i.shout('Loading "'+e+'" bookmarks.....',0,"info"),n.collection.fetch({data:{skip:n.collection.info().totalRecords,tag:e},type:"GET",success:function(r,s,o){s.length>0?(i.shout("Done!",2,"info"),_.each(s,function(e){var r=new t.Bookmark(e);n.collection.origModels.push(r)}),n.collection.filterTags(e),n.render()):(i.shout("Done!",2,"info"),n.collection.filterTags(e),n.render())},error:function(e,t,n){i.shout("Request failed!",5,"warning")}}))},changeCount:function(e){e.preventDefault();var t=i(e.target).text();n.Pagination.changeCount(t)},clearNewBookmark:function(e){e.preventDefault(),i("#new-bookmark-table").fadeOut(function(){i("#new-bookmark-table").remove(),i("#bookmarks-table, #pagination").fadeIn()})},sort:function(e){e.preventDefault();var t=i(e.target).attr("class");t!==this.collection.sortOrder&&this.collection.changeSortOder(t)}})}(Backbone,App.Models,App.Views,EJS,jQuery),function(e,t){"use strict";t.Router=Backbone.Router.extend({routes:{bookmarks:"loadBookmarks","":"loadBookmarks","user/account":"loadAccount","bookmarks/tags/:tag":"filterTags","bookmarks/page/:num":"goTo","bookmarks/new":"newBookmark"},loadAccount:function(){e.Controller.loadAccount(),App.page!=="demo"&&($(".nav-pills li.active").removeClass("active"),$(".nav-pills li.account").addClass("active"))},goTo:function(t){e.Controller.goTo(t),App.page!=="demo"&&($(".nav-pills li.active").removeClass("active"),$(".nav-pills li.bookmarks").addClass("active"))},loadBookmarks:function(){e.Controller.loadBookmarks(),App.page!=="demo"&&($(".nav-pills li.active").removeClass("active"),$(".nav-pills li.bookmarks").addClass("active"))},newBookmark:function(){e.Controller.newBookmarkView(),App.page!=="demo"&&($(".nav-pills li.active").removeClass("active"),$(".nav-pills li.bookmarks").addClass("active"))},filterTags:function(t){e.Controller.filterTags(t),App.page!=="demo"&&($(".nav-pills li.active").removeClass("active"),$(".nav-pills li.bookmarks").addClass("active"))}})}(App.Views,App.Routes),function(e,t,n,r,i){"use strict";t.Pagination=e.View.extend({el:i("#pagination"),paginationTemplate:new r({url:"/javascripts/views/pagination/tmpl/pagination.ejs"}),data:{},events:{"click a.next":"gotoNext","click a.prev":"gotoPrev"},initialize:function(){return _.bindAll(this,"render","changeCount","gotoNext","gotoPage","gotoPrev"),this.collection.on("reset",this.render),this.collection.on("remove",function(e){this.collection.removeFromOGModels(e.cid),this.render(),t.Controls.render()}.bind(this)),this},render:function(){this.data=this.collection.info();var e=this.paginationTemplate.render(this.data);return this.$el.html(e).fadeIn(),this},gotoPrev:function(e){e.preventDefault(),this.collection.previousGroup(),this.render()},gotoNext:function(e){e.preventDefault(),this.collection.nextGroup(),this.render()},gotoPage:function(e){var t=this,r;if(e>=t.collection.info().totalPages&&!t.collection.allFetched){i.shout("Loading more bookmarks.....",0,"info"),r={skip:t.collection.info().totalRecords},t.collection.filteredModels&&(r.tag=t.collection.filteredTag),t.collection.fetch({data:r,type:"GET",success:function(r,s,o){s.length>0?(i.shout("Done!",2,"info"),_.each(s,function(e){var r=new n.Bookmark(e);t.collection.origModels.push(r)}),t.collection.filteredModels&&t.collection.filterTags(t.collection.filteredTag),t.collection.goTo(e)):(t.collection.allFetched=!0,i.shout("All bookmarks have been loaded!",10,"info"),t.collection.goTo(e))},error:function(e,t,n){i.shout("Request failed!",10,"warning")}});return}t.collection.goTo(e)},reset:function(){this.collection.resetFilteredModels(),this.render()},changeCount:function(e){this.collection.setLimit(e),location.hash="#pages/"+this.collection.currentPage}})}(Backbone,App.Views,App.Models,EJS,jQuery),function(e,t,n,r,i,s){"use strict";n.Controller=e.View.extend({el:s("#app-body"),router:{},profile:{},activeView:"",bookmarks:{},controls:{},pagination:{},initialize:function(){return _.bindAll(this,"loadAccount","newBookmarkView","filterTags","loadBookmarks","goTo","assign"),this.$("#profile").hide(),this.router=new i.Router,this.bookmarks=new n.Bookmarks({collection:new r.Bookmarks(this.collection)}),this.controls=new n.Controls({collection:this.bookmarks.collection}),this.pagination=new n.Pagination({collection:this.bookmarks.collection}),this.profile=new n.Profile,n.Controls=this.controls,n.Bookmarks=this.bookmarks,n.Profile=this.profile,n.Pagination=this.pagination,r.Bookmarks=this.bookmarks.collection,this.bookmarks.collection.pager(),this.assign({"#profile":this.profile,"#controls":this.controls,"#bookmarks-table":this.bookmarks,"#pagination":this.pagination}),this},loadAccount:function(){this.$(".home-div, #home, #bookmarks-table").fadeOut(function(){this.$("#bookmarks-table").empty(),this.$("#profile").fadeIn(),this.activeView="profile"}.bind(this))},loadBookmarks:function(){if(this.activeView==="profile"){s("#profile").fadeOut(function(){s("#home, .home-div").fadeIn(),this.pagination.reset(),this.controls.render(),this.activeView="home"}.bind(this));return}s(".home-div").fadeIn(),this.pagination.reset(),this.controls.render(),this.activeView="home"},newBookmarkView:function(){var e=this,n;s("#pagination").fadeOut(function(){n=new t.Bookmark,n=n.createUrlRoot("/bookmarks"),e.bookmarks.newBookmark(n)})},goTo:function(e){this.pagination.gotoPage(e)},filterTags:function(e){this.controls.filterTags(e),this.activeView="filteredTags"},assign:function(e,t){var n;_.isObject(e)?n=e:(n={},n[e]=t);if(!n)return;_.each(n,function(e,t){e.setElement(this.$(t)).render()},this)}})}(Backbone,App.Models,App.Views,App.Collections,App.Routes,jQuery);
